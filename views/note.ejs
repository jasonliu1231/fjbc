<!DOCTYPE html>
<html lang="en">

<head>
  <%-include('head') %>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        overflow: hidden;
        text-align: center;
      }

      canvas {
        display: block;
        background-color: white;
      }

      .nowrap {
        display: inline-block;
        white-space: nowrap;
      }
    </style>
    <script>
      const url = "http://172.16.150.25:8081/api";
      let id = "";
      window.addEventListener("load", () => {
        const urlParams = new URLSearchParams(window.location.search);
        id = urlParams.get('id');
        getAskacademyInfo(id);
        getAskacademyImage(id);
      })

      async function getAskacademyInfo(id) {
        const config = {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        }
        const response = await fetch(`${url}/askacademy/${id}`, config);
        const data = await response.json();
        if (response.ok) {
          const itemNames = Object.keys(data);
          itemNames.forEach(itemName => {
            if (itemName != "created_at" || itemName != "course_list" || itemName != "source_list" || itemName != "english_listening" || itemName != "inquiry_method") {
              const element = document.querySelector(`#${itemName}`);
              if (element != null) {
                element.value = data[itemName];
              }
            }
            // 填表時間
            document.querySelector("#studentInfo").innerHTML = new Date(data.created_at).toLocaleString();
            // 問班來源
            if (itemName == "source_list") {
              if (data[itemName].length > 0) {
                const source_list = document.querySelectorAll(".source_list");
                data[itemName].forEach(i => {
                  source_list.forEach(e => {
                    if (e.value == i.source_name) {
                      e.checked = true;
                    }
                  })
                })
              }

            }
            // 期望科目
            if (itemName == "course_list") {
              if (data[itemName].length > 0) {
                const course_list = document.querySelectorAll(".course_list");
                data[itemName].forEach(i => {
                  course_list.forEach(e => {
                    if (e.value == i.course_name) {
                      e.checked = true;
                    }
                  })
                })
              }
            }
            // 英聽成績
            if (itemName == "english_listening") {
              if (data[itemName] != null) {
                document.querySelector(`input[name="english_listening"][value="${data[itemName]}"]`).checked = true;
              }
            }
            // 詢班方式
            if (itemName == "inquiry_method") {
              if (data[itemName] != null) {
                document.querySelector(`input[name="inquiry_method"][value="${data[itemName]}"]`).checked = true;
              }
            }
          })
        }
      }

      async function getAskacademyImage(id) {
        const config = {
          method: "GET",
          responseType: "arraybuffer",
          headers: {
            // "Content-Type": "application/json",
          },
        }
        const response = await fetch(`${url}/askacademy/image/${id}`, config);
        const data = await response.arrayBuffer();
        if (response.ok) {
          if (data.byteLength != 0) {
            const canvas = document.getElementById('myCanvas');
            const ctx = canvas.getContext('2d');

            // 创建一个 Uint8Array，用于包装 ArrayBuffer 中的数据
            const uint8Array = new Uint8Array(data);

            // 创建一个 ImageData 对象，用于将图像数据绘制到 Canvas 上
            const imageData = ctx.createImageData(window.innerWidth, window.innerHeight * 0.9);

            // 将 ArrayBuffer 中的数据填充到 ImageData 对象中
            imageData.data.set(uint8Array);

            // 将 ImageData 对象绘制到 Canvas 上
            ctx.putImageData(imageData, 0, 0);

          }
        }
      }

      // 保存 Canvas 内容
      function saveAsImage() {
        const canvas = document.getElementById('myCanvas');
        const imageDataURL = canvas.toDataURL('image/png');
        canvas.toBlob(async function (blob) {
          console.log(imageDataURL);
          const file = new File([blob], 'canvas_image.jpeg', { type: 'image/jpeg' });
          let formData = new FormData();
          formData.append("uploaded_file", file);
          console.log(file);
          const config = {
            method: "POST",
            headers: {
              // 設定後要自行設定邊界。所以註解掉
              // "Content-Type": "multipart/form-data",
            },
            body: formData
          }
          const response = await fetch(`${url}/askacademy/image/${id}`, config);
        }, 'image/jpeg');

        const link = document.createElement('a');

      }

      async function submit() {
        // 基本資料
        const student_name = document.querySelector("#student_name").value || null;
        if (!student_name) {
          alert("請填寫學生姓名");
          return;
        }
        const student_name_en = document.querySelector("#student_name_en").value || null;
        const student_mobile = document.querySelector("#student_mobile").value || null;
        const school = document.querySelector("#school").value || null;
        const grade = document.querySelector("#grade").value || null;
        const tel = document.querySelector("#tel").value || null;
        const address = document.querySelector("#address").value || null;
        const father_name = document.querySelector("#father_name").value || null;
        const father_mobile = document.querySelector("#father_mobile").value || null;
        const father_profession = document.querySelector("#father_profession").value || null;
        const father_office_tel = document.querySelector("#father_office_tel").value || null;
        const mother_name = document.querySelector("#mother_name").value || null;
        const mother_mobile = document.querySelector("#mother_mobile").value || null;
        const mother_profession = document.querySelector("#mother_profession").value || null;
        const mother_office_tel = document.querySelector("#mother_office_tel").value || null;
        const holiday_time = document.querySelector("#holiday_time").value || null;
        const Weekday_time = document.querySelector("#Weekday_time").value || null;
        const brother1 = document.querySelector("#brother1").value || null;
        const brother1_grade = document.querySelector("#brother1_grade").value || null;
        const brother2 = document.querySelector("#brother2").value || null;
        const brother2_grade = document.querySelector("#brother2_grade").value || null;

        // 興趣班級
        const course_list_selected = document.querySelectorAll(".course_list");
        const course_list = [];
        course_list_selected.forEach((item) => {
          if (item.checked) {
            course_list.push({
              "course_name": item.value || null
            });
          }
        })
        const course_extend = document.querySelector("#course_extend").value || null;

        // 問班來源
        const source_list_selected = document.querySelectorAll(".source_list");
        const source_list = [];
        source_list_selected.forEach((item) => {
          if (item.checked) {
            source_list.push({
              "source_name": item.value || null
            });
          }
        })

        // 學生狀況
        const exam_ranking = document.querySelector("#exam_ranking").value || null;
        const exam_ranking1 = document.querySelector("#exam_ranking1").value || null;
        const exam_ranking2 = document.querySelector("#exam_ranking2").value || null;
        const chinese_score = document.querySelector("#chinese_score").value || null;
        const math_score = document.querySelector("#math_score").value || null;
        const english_score = document.querySelector("#english_score").value || null;
        const english_listening = document.querySelector("input[name='english_listening']:checked") ? document.querySelector("input[name='english_listening']:checked").value : null;
        const enature_score = document.querySelector("#enature_score").value || null;
        const biology_score = document.querySelector("#biology_score").value || null;
        const physics_score = document.querySelector("#physics_score").value || null;
        const chemical_score = document.querySelector("#chemical_score").value || null;
        const earth_science_score = document.querySelector("#earth_science_score").value || null;
        const physics_chemical_score = document.querySelector("#physics_chemical_score").value || null;
        const social_score = document.querySelector("#social_score").value || null;
        const geography_score = document.querySelector("#geography_score").value || null;
        const history_score = document.querySelector("#history_score").value || null;
        const civics_score = document.querySelector("#civics_score").value || null;

        // 課程表
        const activity_status1 = document.querySelector("#activity_status1").value || null;
        const activity_status2 = document.querySelector("#activity_status2").value || null;
        const activity_status3 = document.querySelector("#activity_status3").value || null;
        const activity_status4 = document.querySelector("#activity_status4").value || null;
        const activity_status5 = document.querySelector("#activity_status5").value || null;
        const activity_status6_1 = document.querySelector("#activity_status6_1").value || null;
        const activity_status6_2 = document.querySelector("#activity_status6_2").value || null;
        const activity_status6_3 = document.querySelector("#activity_status6_3").value || null;
        const activity_status7_1 = document.querySelector("#activity_status7_1").value || null;
        const activity_status7_2 = document.querySelector("#activity_status7_2").value || null;
        const activity_status7_3 = document.querySelector("#activity_status7_3").value || null;
        const inquiry_method = document.querySelector("input[name='inquiry_method']:checked") ? document.querySelector("input[name='inquiry_method']:checked").value : null;
        const reception = document.querySelector("#reception").value || null;

        const info = {
          student_name,
          student_name_en,
          student_mobile,
          tel,
          school,
          grade,
          address,
          brother1,
          brother1_grade,
          brother2,
          brother2_grade,
          father_name,
          father_mobile,
          father_office_tel,
          father_profession,
          mother_name,
          mother_mobile,
          mother_office_tel,
          mother_profession,
          holiday_time,
          Weekday_time,
          // Remark,
          course_extend,
          exam_ranking,
          exam_ranking1,
          exam_ranking2,
          chinese_score,
          math_score,
          english_score,
          english_listening,
          enature_score,
          biology_score,
          physics_score,
          chemical_score,
          earth_science_score,
          physics_chemical_score,
          social_score,
          geography_score,
          history_score,
          civics_score,
          activity_status1,
          activity_status2,
          activity_status3,
          activity_status4,
          activity_status5,
          activity_status6_1,
          activity_status6_2,
          activity_status6_3,
          activity_status7_1,
          activity_status7_2,
          activity_status7_3,
          inquiry_method,
          reception,
          course_list,
          source_list
        }
        saveAsImage()
        // const config = {
        //   method: "PUT",
        //   headers: {
        //     "Content-Type": "application/json",
        //   },
        //   body: JSON.stringify(info)
        // }
        // const response = await fetch(`${url}/askacademy/${id}`, config);
        // if (response.ok) {
        //   window.location.reload()
        // }
      }
    </script>
</head>

<body>
  <div class="offcanvas offcanvas-top" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1"
    id="offcanvasScrolling" aria-labelledby="studentInfo">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="studentInfo">學生資料</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <h5 class="p-2">基本資料</h5>
      <div class="input-group p-1">
        <span class="input-group-text">學生姓名</span>
        <input type="text" aria-label="student_name" id="student_name" class="form-control" />
        <span class="input-group-text">英文名子</span>
        <input type="text" aria-label="student_name_en" id="student_name_en" class="form-control" />
        <span class="input-group-text">學生手機</span>
        <input type="text" aria-label="student_mobile" id="student_mobile" class="form-control" />
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">就讀學校</span>
        <input type="text" aria-label="school" id="school" class="form-control" />
        <span class="input-group-text">年級</span>
        <select class="form-select" id="grade">
          <option value=""></option>
          <option value="幼大班">幼大班</option>
          <option value="國小一年級">國小一年級</option>
          <option value="國小二年級">國小二年級</option>
          <option value="國小三年級">國小三年級</option>
          <option value="國小四年級">國小四年級</option>
          <option value="國小五年級">國小五年級</option>
          <option value="國小六年級">國小六年級</option>
          <option value="國中一年級">國中一年級</option>
          <option value="國中二年級">國中二年級</option>
          <option value="國中三年級">國中三年級</option>
          <option value="高中一年級">高中一年級</option>
          <option value="高中二年級">高中二年級</option>
          <option value="高中三年級">高中三年級</option>
        </select>
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">市話</span>
        <input type="text" aria-label="tel" id="tel" class="form-control" />
        <span class="input-group-text">地址</span>
        <input type="text" aria-label="address" id="address" class="form-control" />
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">父親姓名</span>
        <input type="text" aria-label="father_name" id="father_name" class="form-control" />
        <span class="input-group-text">連絡電話</span>
        <input type="text" aria-label="father_mobile" id="father_mobile" class="form-control" />
        <span class="input-group-text">職業</span>
        <input type="text" aria-label="father_profession" id="father_profession" class="form-control" />
        <span class="input-group-text">公司電話</span>
        <input type="text" aria-label="father_office_tel" id="father_office_tel" class="form-control" />
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">母親姓名</span>
        <input type="text" aria-label="mother_name" id="mother_name" class="form-control" />
        <span class="input-group-text">連絡電話</span>
        <input type="text" aria-label="mother_mobile" id="mother_mobile" class="form-control" />
        <span class="input-group-text">職業</span>
        <input type="text" aria-label="mother_profession" id="mother_profession" class="form-control" />
        <span class="input-group-text">公司電話</span>
        <input type="text" aria-label="mother_office_tel" id="mother_office_tel" class="form-control" />
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">假日連絡時間</span>
        <input type="text" aria-label="holiday_time" id="holiday_time" class="form-control" />
        <span class="input-group-text">平日連絡時間</span>
        <input type="text" aria-label="Weekday_time" id="Weekday_time" class="form-control" />
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">有興趣的班別</span>
        <div class="form-control">
          <div class="nowrap">
            <input class="form-check-input course_list" type="checkbox" value="國文" id="class_chinese" />
            <label class="form-check-label" for="class_chinese"> 國文 </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input course_list" type="checkbox" value="數學" id="class_math" />
            <label class="form-check-label" for="class_math"> 數學 </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input course_list" type="checkbox" value="英文" id="class_english" />
            <label class="form-check-label" for="class_english"> 英文 </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input course_list" type="checkbox" value="社會" id="class_social" />
            <label class="form-check-label" for="class_social"> 社會 </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input course_list" type="checkbox" value="物理" id="class_natural" />
            <label class="form-check-label" for="class_natural"> 物理 </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input course_list" type="checkbox" value="化學" id="class_chemistry" />
            <label class="form-check-label" for="class_chemistry"> 化學 </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input course_list" type="checkbox" value="生物" id="class_biology" />
            <label class="form-check-label" for="class_biology"> 生物 </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input course_list" type="checkbox" value="地科" id="class_earthScience" />
            <label class="form-check-label" for="class_earthScience"> 地科 </label>
          </div>
        </div>
        <span class="input-group-text">其他</span>
        <input id="course_extend" type="text" aria-label="class_other" class="form-control" />
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">其他兄弟姊妹</span>
        <div class="form-control">
          <div class="input-group p-1">
            <span class="input-group-text">兄姐姓名</span>
            <input type="text" aria-label="brother1" id="brother1" class="form-control" />
            <span class="input-group-text">年級</span>
            <select class="form-select" id="brother1_grade">
              <option value=""></option>
              <option value="幼大班">幼大班</option>
              <option value="國小一年級">國小一年級</option>
              <option value="國小二年級">國小二年級</option>
              <option value="國小三年級">國小三年級</option>
              <option value="國小四年級">國小四年級</option>
              <option value="國小五年級">國小五年級</option>
              <option value="國小六年級">國小六年級</option>
              <option value="國中一年級">國中一年級</option>
              <option value="國中二年級">國中二年級</option>
              <option value="國中三年級">國中三年級</option>
              <option value="高中一年級">高中一年級</option>
              <option value="高中二年級">高中二年級</option>
              <option value="高中三年級">高中三年級</option>
            </select>
          </div>
          <div class="input-group p-1">
            <span class="input-group-text">弟妹姓名</span>
            <input type="text" aria-label="brother2" id="brother2" class="form-control" />
            <span class="input-group-text">年級</span>
            <select class="form-select" id="brother2_grade">
              <option value=""></option>
              <option value="幼大班">幼大班</option>
              <option value="國小一年級">國小一年級</option>
              <option value="國小二年級">國小二年級</option>
              <option value="國小三年級">國小三年級</option>
              <option value="國小四年級">國小四年級</option>
              <option value="國小五年級">國小五年級</option>
              <option value="國小六年級">國小六年級</option>
              <option value="國中一年級">國中一年級</option>
              <option value="國中二年級">國中二年級</option>
              <option value="國中三年級">國中三年級</option>
              <option value="高中一年級">高中一年級</option>
              <option value="高中二年級">高中二年級</option>
              <option value="高中三年級">高中三年級</option>
            </select>
          </div>
        </div>
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">如何得知本班資訊</span>
        <div class="form-control">
          <div class="nowrap">
            <input class="form-check-input source_list" type="checkbox" value="親友介紹" id="source1" />
            <label class="form-check-label" for="source1">
              親友介紹
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input source_list" type="checkbox" value="校園DM" id="source2" />
            <label class="form-check-label" for="source2">
              校園DM
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input source_list" type="checkbox" value="寄發DM" id="source3" />
            <label class="form-check-label" for="source3"> 寄發DM </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input source_list" type="checkbox" value="簡訊" id="source4" />
            <label class="form-check-label" for="source4"> 簡訊 </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input source_list" type="checkbox" value="多易文教網站" id="source5" />
            <label class="form-check-label" for="source5">
              多易文教網站
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input source_list" type="checkbox" value="Google 表單" id="source6" />
            <label class="form-check-label" for="source6">
              Google 表單
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input source_list" type="checkbox" value="FaceBook" id="source7" />
            <label class="form-check-label" for="source7">
              FaceBook
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input source_list" type="checkbox" value="關鍵字搜尋" id="source8" />
            <label class="form-check-label" for="source8">
              關鍵字搜尋
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input source_list" type="checkbox" value="電推" id="source9" />
            <label class="form-check-label" for="source9">
              電推
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input source_list" type="checkbox" value="LINE" id="source10" />
            <label class="form-check-label" for="source10">
              LINE
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input source_list" type="checkbox" value="路過" id="source11" />
            <label class="form-check-label" for="source11">
              路過
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input source_list" type="checkbox" value="其他" id="source12" />
            <label class="form-check-label" for="source12">
              其他
            </label>
          </div>
        </div>
      </div>
      <h5 class="p-2">學生狀況</h5>
      <div class="input-group p-1">
        <span class="input-group-text">段考校排</span>
        <input type="text" aria-label="exam_ranking" id="exam_ranking" class="form-control" />
        <span class="input-group-text">模擬考校排</span>
        <input type="text" aria-label="exam_ranking1" id="exam_ranking1" class="form-control" />
        <span class="input-group-text">模擬考區排</span>
        <input type="text" aria-label="exam_ranking2" id="exam_ranking2" class="form-control" />
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">國文成績</span>
        <input type="text" aria-label="chinese_score" id="chinese_score" class="form-control" />
        <span class="input-group-text">數學成績</span>
        <input type="text" aria-label="math_score" id="math_score" class="form-control" />
        <span class="input-group-text">英文成績</span>
        <input type="text" aria-label="english_score" id="english_score" class="form-control" />
        <span class="input-group-text">英聽成績</span>
        <div class="form-control">
          <div class="nowrap">
            <input class="form-check-input" type="radio" name="english_listening" value="3"
              id="english_listening_good" />
            <label class="form-check-label" for="english_listening_good">
              強
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input" type="radio" name="english_listening" value="2" id="english_listening_so" />
            <label class="form-check-label" for="english_listening_so">
              中
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input" type="radio" name="english_listening" value="1"
              id="english_listening_bad" />
            <label class="form-check-label" for="english_listening_bad">
              弱
            </label>
          </div>
        </div>
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">自然成績</span>
        <input type="text" id="enature_score" aria-label="enature_score" class="form-control" />
        <span class="input-group-text">生物成績</span>
        <input type="text" id="biology_score" aria-label="biology_score" class="form-control" />
        <span class="input-group-text">物理成績</span>
        <input type="text" id="physics_score" aria-label="physics_score" class="form-control" />
        <span class="input-group-text">化學成績</span>
        <input type="text" id="chemical_score" aria-label="chemical_score" class="form-control" />
        <span class="input-group-text">地科成績</span>
        <input type="text" id="earth_science_score" aria-label="earth_science_score" class="form-control" />
        <span class="input-group-text">理化成績</span>
        <input type="text" id="physics_chemical_score" aria-label="physics_chemical_score" class="form-control" />
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">社會成績</span>
        <input type="text" id="social_score" aria-label="social_score" class="form-control" />
        <span class="input-group-text">地理成績</span>
        <input type="text" id="geography_score" aria-label="geography_score" class="form-control" />
        <span class="input-group-text">歷史成績</span>
        <input type="text" id="history_score" aria-label="history_score" class="form-control" />
        <span class="input-group-text">公民成績</span>
        <input type="text" id="civics_score" aria-label="civics_score" class="form-control" />
      </div>
      <h5 class="p-2">課程表</h5>
      <div class="input-group p-1">
        <span class="input-group-text">星期一</span>
        <input type="text" id="activity_status1" aria-label="activity_status1" class="form-control" />
        <span class="input-group-text">星期二</span>
        <input type="text" id="activity_status2" aria-label="activity_status2" class="form-control" />
        <span class="input-group-text">星期三</span>
        <input type="text" id="activity_status3" aria-label="activity_status3" class="form-control" />
        <span class="input-group-text">星期四</span>
        <input type="text" id="activity_status4" aria-label="activity_status4" class="form-control" />
        <span class="input-group-text">星期五</span>
        <input type="text" id="activity_status5" aria-label="activity_status5" class="form-control" />
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">星期六-早</span>
        <input type="text" id="activity_status6_1" aria-label="activity_status6_1" class="form-control" />
        <span class="input-group-text">星期六-中</span>
        <input type="text" id="activity_status6_2" aria-label="activity_status6_2" class="form-control" />
        <span class="input-group-text">星期六-晚</span>
        <input type="text" id="activity_status6_3" aria-label="activity_status6_3" class="form-control" />
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">星期日-早</span>
        <input type="text" id="activity_status7_1" aria-label="activity_status7_1" class="form-control" />
        <span class="input-group-text">星期日-中</span>
        <input type="text" id="activity_status7_2" aria-label="activity_status7_2" class="form-control" />
        <span class="input-group-text">星期日-晚</span>
        <input type="text" id="activity_status7_3" aria-label="activity_status7_3" class="form-control" />
      </div>
      <div class="input-group p-1">
        <span class="input-group-text">詢班方式</span>
        <div class="form-control">
          <div class="nowrap">
            <input class="form-check-input" type="radio" value="電話" name="inquiry_method" id="inquiry_tel" />
            <label class="form-check-label" for="inquiry_tel">
              電話
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input" type="radio" value="現場" name="inquiry_method" id="inquiry_live" />
            <label class="form-check-label" for="inquiry_live">
              現場
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input" type="radio" value="E-MAIL" name="inquiry_method" id="inquiry_mail" />
            <label class="form-check-label" for="inquiry_mail">
              E-MAIL
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input" type="radio" value="官網" name="inquiry_method" id="inquiry_web" />
            <label class="form-check-label" for="inquiry_web">
              官網
            </label>
          </div>
          <div class="nowrap">
            <input class="form-check-input" type="radio" value="其他" name="inquiry_method" id="inquiry_other" />
            <label class="form-check-label" for="inquiry_other">
              其他
            </label>
          </div>
        </div>
        <span class="input-group-text">接待老師</span>
        <input type="text" aria-label="reception" id="reception" class="form-control" />
      </div>
      <!-- <p class="px-3 link-danger">已同意本表單收集之個人資料使用權，僅於「多易文理補習班」使用，非經當事人同意，不轉作其他用途。</p> -->
    </div>

  </div>

  <canvas id="myCanvas"></canvas>
  <div class="btn-group" role="group" aria-label="Button group with nested dropdown">
    <select id="size" class="form-select form-select btn btn-outline-primary px-4" aria-label="Small select example"
      onchange="sizeChange()">
      <option value="5" selected>筆尖大小：5</option>
      <option value="10">筆尖大小：10</option>
      <option value="15">筆尖大小：15</option>
      <option value="20">筆尖大小：20</option>
    </select>
    <input type="radio" class="btn-check" name="btnradio" id="drawButton" autocomplete="off" checked>
    <label class="btn btn-outline-primary text-nowrap" for="drawButton">書寫筆：✏️</label>
    <input type="radio" class="btn-check" name="btnradio" id="clearButton" autocomplete="off">
    <label class="btn btn-outline-primary text-nowrap" for="clearButton">橡皮擦：🧽</label>
  </div>
  <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling"
    aria-controls="offcanvasScrolling">學生資訊</button>
  <button id="saveButton" type="button" class="btn btn-outline-success px-4" onclick="submit()">儲存</button>
  <script>
    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let isErasing = false;
    let lastX = 0;
    let lastY = 0;
    let size = document.querySelector('#size').value;

    function sizeChange() {
      size = document.querySelector('#size').value;
    }

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight * 0.9;

    // 監聽點擊瞬間
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('touchstart', startDrawing);

    function startDrawing(event) {
      event.preventDefault();
      if (event.type === 'mousedown' || (event.type === 'touchstart' && event.touches.length === 1)) {
        const { offsetX, offsetY } = getOffset(event);
        if (event.type === 'touchstart') {
          event = event.touches[0];
        }
        isDrawing = true;
        [lastX, lastY] = [offsetX, offsetY];
      }
    }

    // 繪圖
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('touchmove', draw);

    function draw(event) {
      event.preventDefault();
      let isWeb = event.type === 'mousemove' ? event.buttons === 1 : true
      if (event.type === 'touchmove') {
        event = event.touches[0]
      }

      if (isDrawing && isWeb) { // 鼠标左键按下
        const { offsetX, offsetY } = getOffset(event);
        ctx.strokeStyle = isErasing ? 'white' : 'black';
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';
        ctx.lineWidth = size;
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(offsetX, offsetY);
        ctx.stroke();
        [lastX, lastY] = [offsetX, offsetY];
      }
    }

    // 事件在 Canvas 中的偏移位置
    function getOffset(event) {
      const rect = canvas.getBoundingClientRect();
      const offsetX = event.clientX - rect.left;
      const offsetY = event.clientY - rect.top;
      return { offsetX, offsetY };
    }

    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    // 點擊結束
    // canvas.addEventListener('mouseup', endDrawing);
    // canvas.addEventListener('touchend', endDrawing);

    // function endDrawing(event) {
    //   isDrawing = false;
    //   isErasing = false;
    // }

    // 切换模式
    function drawButton() {
      isErasing = false;
    }

    function clearButton() {
      isErasing = true;
    }

    document.getElementById('drawButton').addEventListener('click', drawButton);
    document.getElementById('clearButton').addEventListener('click', clearButton);
  </script>
</body>

</html>